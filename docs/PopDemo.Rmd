---
title: "PopDemo"
author: "Maria Berg"
date: "2025-03-24"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(Housing)



# Convert data to long format for easier plotting
df_long <- pop_data %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(Demographic = gsub("PopEst_", "", Demographic))  # Clean column names

# Create separate bar plots for each region
unique_regions <- unique(df_long$Region)

for (region in unique_regions) {
  p <- ggplot(df_long %>% filter(Region == region), aes(x = as.factor(Year), y = Population, fill = Demographic)) +
    geom_bar(stat = "identity", position = "stack") +
    labs(title = paste("Population Distribution in", region), x = "Year", y = "Population") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))

  print(p)  # Display each plot
}

```

```{r}
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette
library(Housing)

# Convert data to long format for easier plotting
df_long <- pop_data %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(
    Demographic = gsub("PopEst_", "", Demographic),  # Clean column names
    Year = as.factor(Year)  # Ensure Year is categorical for discrete x-axis
  )

# Create faceted bar plot
ggplot(df_long, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Region) +  # Facet by Region
  scale_fill_viridis_d(option = "C", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),  # Adjust legend text size
    legend.title = element_text(size = 10)  # Adjust legend title size
  )

```

```{r}
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette
library(Housing)


# Convert data to long format for easier plotting
df_long <- PopulationData %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(
    Demographic = gsub("PopEst_", "", Demographic),  # Clean column names
    Year = as.factor(Year),  # Ensure Year is categorical for discrete x-axis
    Region = factor(Region, levels = c("Philadelphia", "Chicago", "Los Angeles", "Boston", "Seattle")) # Custom facet order
  )

# Create faceted bar plot with custom layout
ggplot(df_long, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Region, nrow = 2) +  # Ensures 2 rows of facets
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),  # Adjust legend text size
    legend.title = element_text(size = 10)  # Adjust legend title size
  )

```

```{r}
library(scales)   # For formatting y-axis labels

# Create faceted bar plot with custom layout
ggplot(df_long, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Ensures all facets show years
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),  # Adjust legend text size
    legend.title = element_text(size = 10),  # Adjust legend title size
    strip.placement = "outside",  # Ensures proper spacing of facet labels
    strip.text = element_text(size = 12)  # Adjust facet label size if needed
  )


theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),  # Adjust legend text size
    legend.title = element_text(size = 10)  # Adjust legend title size
  )
```

```{r}
library(scales)   # For formatting y-axis labels
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette
library(Housing)


# Convert data to long format for easier plotting
df_long <- HousingMarket %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(
    Demographic = gsub("PopEst_", "", Demographic),  # Clean column names
    Year = as.factor(Year),  # Ensure Year is categorical for discrete x-axis
    Region = factor(Region, levels = c("Philadelphia", "Chicago", "Los Angeles", "Boston", "Seattle")) # Custom facet order
  )

# Create faceted bar plot with custom layout
ggplot(df_long, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Ensures all facets show years
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels as full numbers
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),  # Adjust legend text size
    legend.title = element_text(size = 10),  # Adjust legend title size
    strip.placement = "outside",  # Ensures proper spacing of facet labels
    strip.text = element_text(size = 12)  # Adjust facet label size if needed
  )
```

```{r}
library(scales)   # For formatting y-axis labels
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette
library(Housing)

# Convert data to long format for easier plotting
df_long <- HousingMarket %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(
    Demographic = gsub("PopEst_", "", Demographic),  # Clean column names
    Year = as.factor(Year),  # Ensure Year is categorical for discrete x-axis
    Region = factor(Region, levels = c("Philadelphia", "Chicago", "Los Angeles", "Boston", "Seattle")) # Custom facet order
  ) %>%
  filter(!Demographic %in% c("TOTAL POPULATION", "18 YEARS AND OVER"))  # Exclude these demographics

# Create faceted bar plot with custom layout
ggplot(df_long, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Ensures all facets show years
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels as full numbers
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),  # Adjust legend text size
    legend.title = element_text(size = 10),  # Adjust legend title size
    strip.placement = "outside",  # Ensures proper spacing of facet labels
    strip.text = element_text(size = 12)  # Adjust facet label size if needed
  )

```

```{r warning=FALSE}
library(scales)   # For formatting y-axis labels
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette

# Keep only population-related columns (Region, Year, and Population Estimates) & remove duplicates
df_filtered <- HousingMarket %>%
  select(Region, Year, starts_with("PopEst_")) %>%
  distinct(Region, Year, .keep_all = TRUE)  # Keep only one row per Region-Year

# Convert data to long format for easier plotting
df_long <- df_filtered %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(
    Demographic = gsub("PopEst_", "", Demographic),  # Clean column names
    Year = as.factor(Year),  # Ensure Year is categorical for discrete x-axis
    Region = factor(Region, levels = c("Philadelphia", "Chicago", "Los Angeles", "Boston", "Seattle")) # Custom facet order
  ) %>%
  filter(!Demographic %in% c("TOTAL POPULATION", "18 YEARS AND OVER"))  # Exclude these demographics

# Create faceted bar plot with custom layout
ggplot(df_long, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Ensures all facets show years
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels as full numbers
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    #legend.position = "bottom",
    legend.position = c(0.999, 0.08),  # Adjust x and y to move legend into empty space
    legend.justification = c(1, 0),
    legend.text = element_text(size = 9),  # Adjust legend text size
    legend.title = element_text(size = 13),  # Adjust legend title size
    strip.placement = "outside",  # Ensures proper spacing of facet labels
    strip.text = element_text(size = 12)  # Adjust facet label size if needed
  )  

```

```{r warning=FALSE}
library(scales)   # For formatting y-axis labels
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette

# Keep only population-related columns & remove duplicates
df_filtered <- HousingMarket %>%
  select(Region, Year, starts_with("PopEst_"), starts_with("PopPct_")) %>%
  distinct(Region, Year, .keep_all = TRUE)  # Keep only one row per Region-Year

# Convert population data to long format
df_long <- df_filtered %>%
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(Demographic = gsub("PopEst_", "", Demographic))  # Clean column names


# Convert percentage data to long format and join with df_long
df_pct_long <- df_filtered %>%
  pivot_longer(
    cols = starts_with("PopPct_"), 
    names_to = "Demographic", 
    values_to = "Percentage"
  ) %>%
  mutate(
    Demographic = gsub("PopPct_", "", Demographic),
    Percentage = round(Percentage * 100, 1)  # Convert to proper percentage format
  )  

# Merge population and percentage data
df_final <- left_join(df_long, df_pct_long, by = c("Region", "Year", "Demographic"))

# Exclude total population and 18+ demographics
df_final <- df_final %>%
  filter(!Demographic %in% c("TOTAL POPULATION", "18 YEARS AND OVER"))

df_final <- df_final %>%
  mutate(
    Region = factor(Region, levels = c("Philadelphia", "Chicago", "Los Angeles", "Boston", "Seattle")),
   Demographic = factor(Demographic, levels = c("SOME OTHER RACE ALONE", "ASIAN ALONE", "BLACK OR AFRICAN AMERICAN ALONE", 
                                             "AMERICAN INDIAN AND ALASKA NATIVE ALONE", "HISPANIC OR LATINO (OF ANY RACE)", 
                                             "NATIVE HAWAIIAN AND OTHER PACIFIC ISLANDER ALONE", "WHITE ALONE", "TWO OR MORE RACES"))

  )















# Create faceted bar plot with percentage labels
ggplot(df_final, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  geom_text(aes(
    label = paste0(Percentage, "%")),  # Add percentage label
    position = position_stack(vjust = 0.5),  # Ensure labels appear inside the bars
    size = 1, color = "white", fontface = "bold") +  # Adjust size & color for visibility
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Facet by region
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels as full numbers
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    strip.placement = "outside",
    strip.text = element_text(size = 12)
  )  


```



```{r}
# Filter only 2023 data for percentage labels
df_2023 <- df_final %>%
  filter(Year == 2023)

# Create faceted bar plot with 2023 percentages off to the side
ggplot(df_final, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "stack") +
  # Add only 2023 percentages outside bars
  geom_text(
    data = df_2023,
    aes(
      x = 2023.5,  # Place slightly to the right of 2023 bars
      y = Population,  # Align with top of each bar stack
      label = paste0(Percentage, "%")
    ),
    size = 3, color = "black", fontface = "bold", hjust = 0  # Adjust position
  ) +
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Facet by region
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels as full numbers
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    strip.placement = "outside",
    strip.text = element_text(size = 12)
  )

```








```{r}
ggplot(df_final, aes(x = Year, y = Population, fill = Demographic)) +
  geom_bar(stat = "identity", position = "fill") +  # Use fill instead of stack
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Show y-axis as percentages
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Percentage of Population",
       fill = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    strip.placement = "outside",
    strip.text = element_text(size = 12)
  )

```


```{r}
library(scales)   # For formatting y-axis labels
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)  # Colorblind-friendly palette

# Keep only population-related columns & remove duplicates
df_filtered <- HousingMarket %>% 
  select(Region, Year, starts_with("PopEst_"), starts_with("PopPct_")) %>%
  distinct(Region, Year, .keep_all = TRUE)  # Keep only one row per Region-Year

# Convert population data to long format
df_long <- df_filtered %>% 
  pivot_longer(
    cols = starts_with("PopEst_"), 
    names_to = "Demographic", 
    values_to = "Population"
  ) %>%
  mutate(Demographic = gsub("PopEst_", "", Demographic))  # Clean column names

# Convert percentage data to long format and join with df_long
df_pct_long <- df_filtered %>% 
  pivot_longer(
    cols = starts_with("PopPct_"), 
    names_to = "Demographic", 
    values_to = "Percentage"
  ) %>% 
  mutate(
    Demographic = gsub("PopPct_", "", Demographic),
    Percentage = round(Percentage * 100, 1)  # Convert to proper percentage format
  )

# Merge population and percentage data
df_final <- left_join(df_long, df_pct_long, by = c("Region", "Year", "Demographic"))

# Exclude total population and 18+ demographics
df_final <- df_final %>% 
  filter(!Demographic %in% c("TOTAL POPULATION", "18 YEARS AND OVER"))

# Set factor levels for Region and Demographic
df_final <- df_final %>% 
  mutate(
    Region = factor(Region, levels = c("Philadelphia", "Chicago", "Los Angeles", "Boston", "Seattle")),
    Demographic = factor(Demographic, levels = c("SOME OTHER RACE ALONE", "ASIAN ALONE", "BLACK OR AFRICAN AMERICAN ALONE",
                                                 "AMERICAN INDIAN AND ALASKA NATIVE ALONE", "HISPANIC OR LATINO (OF ANY RACE)",
                                                 "NATIVE HAWAIIAN AND OTHER PACIFIC ISLANDER ALONE", "WHITE ALONE", "TWO OR MORE RACES"))
  )

# Create faceted bar plot with percentage labels and secondary line graph for percentage trends
ggplot(df_final, aes(x = Year, y = Population, fill = Demographic)) +
  # Stacked bar chart for population size
  geom_bar(stat = "identity", position = "stack") +
  # Add percentage labels inside the bars
  geom_text(aes(label = paste0(Percentage, "%")),  
            position = position_stack(vjust = 0.5), 
            size = 1, color = "white", fontface = "bold") +
  # Add secondary line graph for percentage trends
  geom_line(aes(y = Percentage * max(df_final$Population) / 100, color = Demographic), 
            linewidth = 1, linetype = "dashed") +  # Use linewidth instead of size
  geom_point(aes(y = Percentage * max(df_final$Population) / 100, color = Demographic), 
             size = 2) +  # Keep size for points
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  # Facet by region
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Colorblind-friendly palette
  scale_color_viridis_d(option = "A", begin = 0.1, end = 0.9) +  # Use the same color scale for the line graph
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels as full numbers
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic",
       color = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    strip.placement = "outside",
    strip.text = element_text(size = 12)
  )

```

```{r warning = false}
ggplot(df_final, aes(x = Year, y = Population, fill = Demographic)) +
  # Stacked bar chart for population size with wider bars
  geom_bar(stat = "identity", position = "stack") +  
  # Add percentage labels inside the bars
  geom_text(aes(label = paste0(Percentage, "%")),  
            position = position_stack(vjust = 0.5), 
            size = 1, color = "white", fontface = "bold") +
  geom_point(aes(y = Percentage * max(df_final$Population) / 100, color = Demographic), 
             size = 2) +  
  facet_wrap(~ Region, nrow = 2, scales = "free_x") +  
  scale_fill_viridis_d(option = "A", begin = 0.1, end = 0.9) +  
  scale_color_viridis_d(option = "A", begin = 0.1, end = 0.9) +  
  scale_y_continuous(labels = scales::comma) +  
  labs(title = "Population Distribution by Region and Year",
       x = "Year", 
       y = "Population",
       fill = "Demographic",
       color = "Demographic") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 8),
    legend.title = element_text(size = 10),
    strip.placement = "outside",
    strip.text = element_text(size = 12)
  )

```



